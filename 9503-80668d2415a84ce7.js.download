try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="78e0588b-9669-4ea6-b212-8bd41a605427",e._sentryDebugIdIdentifier="sentry-dbid-78e0588b-9669-4ea6-b212-8bd41a605427")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9503],{6963:(e,t,i)=>{i.d(t,{B6:()=>g,FP:()=>l,kI:()=>p});var n=i(31481),o=i(12142),a=i(35936),s=i(85756),r=i(66415);let g=(e,t)=>(e.timestamp||0)-(t.timestamp||0),l=(e,t)=>{let i=(0,r.E6)(t,e);return Object.values(s.le).includes(e)?i:(0,r.jr)(i,e,5)},d=e=>e.promptMagic&&!e.promptMagicStrength?e.initStrength:e.promptMagicStrength,m=e=>e.photoReal&&!e.photoRealStrength?e.initStrength:e.photoRealStrength,c=e=>e.photoReal&&!e.photoRealVersion?n.PhotoRealVersion.V1:e.photoRealVersion,u=e=>e.promptMagic&&!e.promptMagicStrength||e.photoReal&&!e.photoRealStrength?null:e.initStrength,p=(e,t)=>{let i=(e.generation_elements||[]).filter(e=>!!e&&!!e.lora).map(e=>({id:e.lora.akUUID,weight:e.weightApplied,isEnabled:!0})),s={...o.TG,contrastBoost:e.contrastRatio,height:e.imageHeight,highResolution:e.highResolution,imagePromptStrength:e.imagePromptStrength,imageStrength:u(e),leonardoMagicVersion:e.promptMagicVersion,modelId:e.modelId,negativePrompt:e.negativePrompt,prompt:e.prompt,scheduler:e.scheduler,promptMagicStrength:d(e),photoRealStrength:m(e),stepCount:e.inferenceSteps,style:e.presetStyle,tiling:e.tiling,usingAlchemy:e.alchemy,usingPhotoReal:e.photoReal,photoRealVersion:c(e),usingHighContrast:e.highContrast,usingLeonardoMagic:e.promptMagic,usingNegativePrompt:!!e.negativePrompt,width:e.imageWidth,elements:i,public:t.public,usingRecommendedDimensions:t.usingRecommendedDimensions},g={...o.TG,...(e=>{let t={...e};return Object.keys(t).forEach(e=>null===t[e]&&delete t[e]),t})(s)},l=(0,r._y)({width:g.width,height:g.height,usingAlchemy:g.usingAlchemy,usingHighRes:g.highResolution,promptMagicVersion:g.leonardoMagicVersion,usingPromptMagic:g.usingLeonardoMagic,usingPhotoRealV1:g.usingPhotoReal&&g.photoRealVersion===n.PhotoRealVersion.V1,usingPhotoRealV2:g.usingPhotoReal&&g.photoRealVersion===n.PhotoRealVersion.V2,usingAlchemyV2:g.usingAlchemy&&(0,a.p4)(g.modelId)&&!g.usingPhotoReal,usingTransparency:g.usingTransparency});return g.numberOfImages=t.numberOfImages>l?l:t.numberOfImages,g}},12142:(e,t,i)=>{i.d(t,{Az:()=>d,TG:()=>g,r0:()=>l,rh:()=>r});var n=i(31481),o=i(46671),a=i(958),s=i(85756),r=function(e){return e.IMG_2_IMG="IMG_2_IMG",e.IMG_PROMPT="IMG_PROMPT",e.INPAINT_OUTPAINT="INPAINT_OUTPAINT",e}({});let g={prompt:"",negativePrompt:"",modelId:n.generationDefaults.modelId.default,sdVersion:"",numberOfImages:4,width:1024,height:576,imageSize:void 0,guidanceScale:7,stepCount:10,scheduler:o.sd_generation_schedulers.LEONARDO,imageStrength:.3,photoRealStrength:s.We.Medium,promptMagicStrength:.3,public:!0,tiling:!1,style:o.sd_generation_style.LEONARDO,styleUUID:void 0,seed:void 0,initImage:void 0,imagePrompts:[],collections:[],poseToImageType:o.POSE_TO_IMAGE_TYPE.POSE,poseToImageWeight:.75,presetId:void 0,imageToImageStrategy:"IMG_2_IMG",motionPrompts:[{prompt:"",durationSeconds:2}],highResolution:!1,contrast:void 0,contrastBoost:.5,resonance:15,usingAlchemy:!1,usingLeonardoMagic:n.generationDefaults.promptMagic.default,usingHighContrast:!0,usingPoseToImage:!1,usingMotion:n.generationDefaults.motion.default,usingSvd:n.generationDefaults.svd.default,usingPhotoReal:!1,photoRealVersion:n.PhotoRealVersion.V2,usingTransparency:a.P2Y.Disabled,leonardoMagicVersion:o.PROMPT_MAGIC_VERSIONS.v2,elements:[],userElements:[],imageInputs:[],usingExpandedDomain:!1,usingFixedSeed:!1,usingNegativePrompt:!1,usingRecommendedDimensions:!0,teamId:void 0,enhancePrompt:void 0,enhancePromptInstruction:void 0,ultra:!1},l={usingAlchemy:!0,style:o.sd_generation_style.DYNAMIC},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.assign({...g},e)}},39264:(e,t,i)=>{i.d(t,{W8:()=>p,ck:()=>u,gL:()=>v});var n=i(31481),o=i(46671),a=i(78966),s=i.n(a),r=i(89392),g=i(48392),l=i(78163),d=i(958),m=i(25634),c=i(87358);let u=async(e,t,i)=>{let n=e.getState(),{dispatch:a}=e,{trial:{alchemy:{data:r}}}=n,g=!0,l=s()(r),d=(null==t?void 0:t.usingPhotoReal)||n.generation.settings.usingPhotoReal,m=(null==t?void 0:t.leonardoMagicVersion)||n.generation.settings.leonardoMagicVersion,c=(null==i?void 0:i.generationAlchemy.create)||!1;if(!c){let e=await I({dispatch:a,alchemyTrialStateData:r});(g=e.usingAlchemy)||(d=!1,m=o.PROMPT_MAGIC_VERSIONS.v2),l=e.trialState}return{usingAlchemy:g,usingPhotoReal:d,leonardoMagicVersion:m,updatedAlchemyTrialStateData:l,isAlchemyAllowed:c}},p=e=>{let{alchemyTrialStateData:t,thunkApi:i,isAlchemyAllowed:n}=e,o=i.getState(),{dispatch:a}=i,{modals:{hasViewed:s}}=o;return n?M({dispatch:a,hasViewed:s}):T({dispatch:a,alchemyTrialStateData:t,hasViewed:s})},h={usingAlchemy:!1},_={usingAlchemy:!0},I=async e=>{let{alchemyTrialStateData:t,dispatch:i}=e;if(v())return{..._,trialState:null};if(!t&&!(t=await S(i)))return{...h,trialState:null};let{isInTrialPeriod:n,hasReachedDailyLimit:o}=t;return!n||o?{...h,trialState:t}:{..._,trialState:t}},S=async e=>{try{var t;let i=await m.Ay.mutate({mutation:d.cbz});return e((0,l.U)()),null===(t=i.data)||void 0===t?void 0:t.startUserAlchemyTrial}catch(e){return console.error("tryStartAlchemyTrial(): ".concat(e.message)),null}},T=e=>{let{dispatch:t,hasViewed:i,alchemyTrialStateData:n}=e;if(!n)return;let{isInTrialPeriod:o,hasReachedDailyLimit:a}=n,s=i[g.A.FEATURE_INTRO_ALCHEMY_TRIAL];return o?a?t((0,r.n2)({modal:g.A.ALCHEMY_GENERATIONS_USED})):s?void 0:t((0,r.n2)({modal:g.A.FEATURE_INTRO_ALCHEMY_TRIAL})):t((0,r.n2)({modal:g.A.ALCHEMY_EXPIRED}))},M=e=>{let{dispatch:t,hasViewed:i}=e;if(!i[g.A.FEATURE_INTRO_ALCHEMY_TRIAL])return t((0,r.n2)({modal:g.A.FEATURE_INTRO_ALCHEMY_TRIAL}))},v=()=>"true"===c.env.NEXT_PUBLIC_MOCK_ALCHEMY_ACCESS_UNRESTRICTED||"false"!==c.env.NEXT_PUBLIC_MOCK_ALCHEMY_ACCESS_UNRESTRICTED&&(0,n.getAlchemyAccessDetails)().unrestricted},60519:(e,t,i)=>{i.d(t,{ac:()=>N,xl:()=>C,Dd:()=>D,oc:()=>V,Kt:()=>b});var n=i(6328),o=i(18056),a=i(66861),s=i(86182),r=i(6963),g=i(68153),l=i(31481),d=i(46671),m=i(7524),c=i(24664),u=i.n(c),p=i(25634),h=i(85756),_=i(66415),I=i(52592),S=i(35936),T=i(69756),M=i(30284),v=i(958),O=i(78373),P=i(12142),y=i(62618),R=i(31698);let f=e=>!e.usingLeonardoMagic||e.leonardoMagicVersion===d.PROMPT_MAGIC_VERSIONS.v3&&(0,S.kt)(e.sdVersion)||e.leonardoMagicVersion===d.PROMPT_MAGIC_VERSIONS.v3&&!e.usingAlchemy?{usingLeonardoMagic:!1}:{usingLeonardoMagic:e.usingLeonardoMagic,leonardoMagicVersion:(0,S.kt)(e.sdVersion)?d.PROMPT_MAGIC_VERSIONS.v2:e.leonardoMagicVersion},G=async function(e,t,i){var n,o,a,s,r,g,c,T;let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},G=arguments.length>4?arguments[4]:void 0,w=arguments.length>5?arguments[5]:void 0,L=arguments.length>6?arguments[6]:void 0,b=i.getState(),{dispatch:N}=i,{modelId:V,prompt:C,width:D,height:F,imageSize:z,negativePrompt:U,seed:x,numberOfImages:k,contrast:Y,guidanceScale:q,stepCount:H,scheduler:W,imageStrength:B,promptMagicStrength:X,photoRealStrength:j,public:K,tiling:Z,style:J,styleUUID:$,usingNegativePrompt:Q,onPending:ee,canvasInitId:et,canvasMaskId:ei,canvasRequestType:en,collections:eo,usingFixedSeed:ea,usingPoseToImage:es,poseToImageType:er,poseToImageWeight:eg,usingHighContrast:el,sdVersion:ed,dilate_mask:em,usingMotion:ec,usingAlchemy:eu,resonance:ep,contrastBoost:eh,highResolution:e_,usingExpandedDomain:eI,imageToImageStrategy:eS,elements:eT,userElements:eM,usingPhotoReal:ev,usingTransparency:eO,photoRealVersion:eP,motionPrompts:ey,imageInputs:eR=[],imageGuidanceInfo:ef,teamId:eG,enhancePrompt:eA,enhancePromptInstruction:eE,ultra:ew}=e;(0,m.Z)({type:"state",category:"generateAiImage",message:"Processing settings for generation",data:e,level:"debug"});let eL=b.generation.modelInfo.modelInfoMap,eb=null!==(r=null===(n=eL[V])||void 0===n?void 0:n.sdVersion)&&void 0!==r?r:ed,eN=null!==(g=null==w?void 0:null===(o=w.generationImageGuidancePremium)||void 0===o?void 0:o.create)&&void 0!==g&&g,eV=null!==(c=null==w?void 0:null===(a=w.generationImageGuidancePremiumLimit)||void 0===a?void 0:a.create)&&void 0!==c&&c,eC=t=>{var i;let n=(null==t?void 0:t.type)===R.w.ControlNet?null==L?void 0:null===(i=L.find(e=>{var i;return e.controlnetType===(null==t?void 0:null===(i=t.match)||void 0===i?void 0:i.controlnetType)}))||void 0===i?void 0:i.preprocessors.find(i=>(0,M.Ul)({preprocessor:i,controlNetMatch:t.match,usingPhotoReal:e.usingPhotoReal,usingAlchemy:e.usingAlchemy,usingLeonardoMagic:e.usingLeonardoMagic,leonardoMagicVersion:e.leonardoMagicVersion,currentSdVersion:eb})):void 0;return!0===(0,M.is)({imageInput:t,imageInputIdx:0,imageInputs:eR.filter(e=>e.isEnabled),usingLeonardoMagic:e.usingLeonardoMagic,usingAlchemy:e.usingAlchemy,currentSdVersion:eb,leonardoMagicVersion:e.leonardoMagicVersion,usingPhotoReal:e.usingPhotoReal,usingTransparency:e.usingTransparency,photoRealVersion:e.photoRealVersion,inputBaseModel:null==n?void 0:n.preprocessorBaseModel})},eD=eR.filter(e=>e.isEnabled&&eC(e)),eF=eD.find(e=>e.type===R.w.Img2Img),ez=eD.filter(e=>e.type===R.w.ImagePrompt),eU=eR.filter(e=>e.type===R.w.ControlNet&&e.isEnabled),ex=(await (0,_.gN)({controlnets:eU,imageInputs:eR.filter(e=>e.isEnabled),apolloClient:p.Ay,usingAlchemy:e.usingAlchemy,currentSdVersion:eb,leonardoMagicVersion:e.leonardoMagicVersion,usingPhotoReal:e.usingPhotoReal,usingLeonardoMagic:e.usingLeonardoMagic,usingTransparency:e.usingTransparency,photoRealVersion:e.photoRealVersion,isGenerationImageGuidancePremiumAllowed:eN})).map(e=>({preprocessorId:e.preprocessorId,initImageType:e.initImageType,initImageId:e.initImageId,weight:e.weighting,strengthType:e.strengthType,influence:e.influence,controlnetType:e.match.controlnetType})).slice(0,eV?l.CONTROLNETS_LIMIT_PREMIUM_USER:l.CONTROLNETS_LIMIT_FREE_USER),ek=ex.map(e=>({preprocessorId:e.preprocessorId,initImageType:e.initImageType,initImageId:e.initImageId,weight:e.weight,strengthType:e.strengthType,influence:e.influence})),eY=(0,_.e$)(p.Ay,ev&&eP!==l.PhotoRealVersion.V2?I.gP.v1_5:eb,eT||[]).map(e=>{let t=(0,_.$5)(e.id),i=p.Ay.readFragment({id:t,fragment:v.veP});return{id:e.id,weightApplied:e.weight,lora:i}}),eq=eY.map(e=>({akUUID:e.id,weight:e.weightApplied})),{usingLeonardoMagic:eH,leonardoMagicVersion:eW}=f(e),eB=Q?U:"",eX=!!((et||ei)&&en),ej=!(0,S.Bw)(V),eK=ea?x:void 0,eZ={leonardoMagic:eH};eS===P.rh.IMG_PROMPT&&(eZ.imagePrompts=ez.map(e=>null==e?void 0:e.initImageId).filter(Boolean)),eF&&!eX&&(eF.initImageType===v.AbP.Uploaded?eZ.init_image_id=eF.initImageId:eF.initImageType===v.AbP.Generated&&(eZ.init_generation_image_id=eF.initImageId));let eJ=!!eF||eX,e$=(null==eF?void 0:eF.type)===R.w.Img2Img?eF.weighting:B,eQ=!!ez.length,e0=null===(s=ez[0])||void 0===s?void 0:s.weighting,e1={init_strength:eJ?e$:void 0,imagePromptWeight:eQ?e0:void 0,promptMagicStrength:eH?X:void 0,photoRealStrength:ev&&eP!==l.PhotoRealVersion.V2?j:void 0},e2={};eu&&(e2={alchemy:!0},(ev||!(0,S.kt)(null!=eb?eb:""))&&(e2.highResolution=!!e_,e2.contrastRatio=eh,e2.guidance_scale=ep));let e6=u()(16).toString("hex"),e8=null!==(T=eL[V])&&void 0!==T?T:ed?h.tv[ed]:null,e3={id:e6,imageWidth:D,imageHeight:F,prompt:C,negativePrompt:eB,coreModel:d.core_models.SD,custom_model:{id:V,name:(null==e8?void 0:e8.name)||"Error"},status:h.iD,createdAt:"0",presetStyle:J,styleUUID:$,quantity:k,seed:eK,public:K,inferenceSteps:H,modelId:V,guidanceScale:q,scheduler:W,tiling:Z,highContrast:el,promptMagic:eH,generation_controlnets:[],generation_elements:eY,photoReal:ev,transparency:eO,nsfw:!1,prompt_moderations:[],notes:[]};null==ee||ee(e3);let{controlnets:e5,...e4}=ef||{},e9={arg1:{prompt:C,negative_prompt:eB,nsfw:!0,num_images:k,width:D,height:F,image_size:z,num_inference_steps:H,contrast:Y,guidance_scale:q,sd_version:eb,modelId:(0,S.iX)({usingPhotoReal:ev,customRequest:ej,photoRealVersion:eP,modelId:V}),presetStyle:J,scheduler:W,public:null==K||K,tiling:null!=Z&&Z,seed:eK,...eZ,...e1,...e2,...eX?{canvasInitId:et,canvasMaskId:ei,canvasRequestType:en,canvasRequest:eX}:{},poseToImage:es,poseToImageType:er,presetId:e.presetId,weighting:eg,highContrast:(!!eH||!!ev)&&el,dilate_mask:em,expandedDomain:eu?eI:void 0,leonardoMagicVersion:eW,elements:eq,userElements:(null!=eM?eM:[]).map(e=>({userLoraId:Number(e.id),weight:e.weight})),controlnets:(null==e5?void 0:e5.length)?e5:ek,photoReal:ev,photoRealVersion:ev?eP:void 0,teamId:eG,transparency:eO,styleUUID:$,enhancePrompt:eA,enhancePromptInstruction:eE,collectionIds:eo.map(e=>parseInt(e.id,10)),ultra:ew,...e4}};if(ec&&t.isMotionEnabled)return E(e6,{public:K,modelId:V,height:F,width:D,style:J,numImages:k,scheduler:"LEONARDO",segments:[{...ey[0],negativePrompt:Q?U:""}]},{onSuccess:()=>{N((0,y.FS)())}},O);let e7=[eJ?"ImageToImage":""].filter(e=>e),te=null==ex?void 0:ex.map(e=>e.controlnetType).sort().join(", "),tt=te?te+(e7.length>0?", "+e7.join(", "):""):e7.join(", "),ti={...e9.arg1,platform:l.platform.WEB,elements:null==eY?void 0:eY.map(e=>e.id).sort().join(", "),elements_count:null==eY?void 0:eY.length,user_elements:(null!=eM?eM:[]).map(e=>e.id).join(", "),user_elements_count:(null!=eM?eM:[]).length,image_guidance:tt,image_guidance_count:(null==ex?void 0:ex.length)+(null==e7?void 0:e7.length),prompt_source:G,...O};return A(e6,e9,{onSuccess:()=>{N((0,y.FS)())}},ti)},A=async(e,t,i,n)=>{let{onSuccess:o}=i;(0,O.u4)(T.TP,n),(0,m.Z)({type:"state",category:"generateAiImage",message:"Submitting mutation",data:t.arg1,level:"debug"});try{var a,s;let i=await p.Ay.mutate({mutation:v.cU$,variables:t});o();let n=null==i?void 0:null===(s=i.data)||void 0===s?void 0:null===(a=s.sdGenerationJob)||void 0===a?void 0:a.generationId;if(!n)throw Error("Error on AI Image Generation. Could not deduplicate request (".concat(n,"). No returned id."));return{requestId:e,newGenerationId:n}}catch(t){return console.error("Error on generate-mutations: AI Image Generation",t),{error:t,requestId:e}}},E=async(e,t,i,n)=>{let{onSuccess:o}=i,a={...t,...n};(0,O.u4)(T.ct,a),(0,m.Z)({type:"state",category:"generateAiMotion",message:"Submitting mutation",data:t,level:"debug"});try{var s,r;let i=await p.Ay.mutate({mutation:v.X5k,variables:t});o();let n=null==i?void 0:null===(r=i.data)||void 0===r?void 0:null===(s=r.motionGenerationJob)||void 0===s?void 0:s.generationId;if(!n)throw Error("Error on AI Motion Generation. Could not deduplicate request (".concat(n,"). No returned id."));return{requestId:e,newGenerationId:n}}catch(t){return console.error("Error on generate-mutations: AI Motion Generation",t),{error:t,requestId:e}}};var w=i(39264);let L=async(e,t)=>{let i={},n={},o={},a=[],s=Array.from(new Set([...h.sW,...e])),{data:r}=await p.Ay.query({query:v.t9w,variables:{where:{id:{_in:s}}},fetchPolicy:"network-only"});for(let e of r.custom_models||[]){var g;let t=e.id;a.push(t);let s=(null===(g=e.generated_image)||void 0===g?void 0:g.url)||null,r={...e,id:t,image:s,style:(0,S.Co)(t),motion:void 0===e.motion?null:e.motion,instancePrompt:e.instancePrompt||"",sdVersion:e.sdVersion};i[t]=r,(0,S.iY)(t)?n[t]=r:o[t]=r}for(let i of(o[l.LEONARDO_MOTION_MODEL_ID]&&(o[l.LEONARDO_MOTION_MODEL_ID].image="/img/motion-model.webp"),e))a.includes(i)||t(i);return[{...i,...h.tv},n,o]},b=(0,n.zD)("generation/updateModelInfoMaps",async(e,t)=>{try{let i=t.getState(),n=t.dispatch,[a,s,r]=await L([...e,...i.generation.lastModelIds,i.generation.settings.modelId].filter(e=>(0,o.A)(e)),e=>{n((0,g.IJ)(e)),e===i.generation.settings.modelId&&n((0,g.Z2)(P.TG.modelId))});return{modelInfoMap:a,leoModelInfoMap:s,customModelInfoMap:r}}catch(e){throw console.error("Error in redux/generation/updateModelInfoMaps",e),Error("Error in redux/generation/updateModelInfoMaps")}}),N=(0,n.zD)("generation/genAiImage",async(e,t)=>{let{settings:i,flags:n,tokenData:o={},promptSource:a,permissions:s,imageInputDefinitions:r}=e,g=await G(i,n,t,o,a,s,r);return g.error&&console.error("Error in redux/generation/genAIImage: ".concat(g.error.message)),g}),V=(0,n.zD)("generation/setSettings",async(e,t)=>{let i=e.newSettings;if((0,s.tz)(e.newSettings)){let{updatedAlchemyTrialStateData:n,isAlchemyAllowed:o,...a}=await (0,w.ck)(t,e.newSettings,e.permissions);i={...i,...a},(0,w.W8)({thunkApi:t,alchemyTrialStateData:n,isAlchemyAllowed:o})}return i}),C=(0,n.zD)("generation/remixSettings",async(e,t)=>{let i=t.getState(),n=(0,r.kI)(e,i.generation.settings),o=n;if((0,s.tz)(n)){var g;let{updatedAlchemyTrialStateData:e,...a}=await (0,w.ck)(t,n);o={...n,...a};let{user:{plan:s,teams:r,selectedTeam:l}}=i,d=null==r?void 0:null===(g=r.find(e=>e.akUUID===l))||void 0===g?void 0:g.plan;(0,w.W8)({thunkApi:t,alchemyTrialStateData:e,isAlchemyAllowed:(0,_.wZ)(null!=d?d:s)})}return new a.A({modelInfoMap:i.generation.modelInfo.modelInfoMap}).transform({currentSettings:n,nextSettings:o})}),D=(0,n.zD)("generation/setPremiumInitialSettings",async(e,t)=>{let i=t.getState(),n=t.dispatch;JSON.stringify(i.generation.settings)===JSON.stringify((0,P.Az)())&&e&&n(V({newSettings:P.r0}))})},66861:(e,t,i)=>{i.d(t,{A:()=>T});var n=i(31481),o=i(46671),a=i(7524),s=i(78966),r=i.n(s);let g={IMAGE_TO_IMAGE:"imageToImageStrategy",LEONARDO_MAGIC:"usingLeonardoMagic",PHOTO_REAL:"usingPhotoReal",ALCHEMY:"usingAlchemy",SVD:"usingSvd",TRANSPARENCY:"usingTransparency"};var l=i(86182),d=i(958),m=i(85756),c=i(66415),u=i(12142),p=i(31698),h=i(35936),_=i(87358),I=function(e){return e.TOGGLED_ON="TOGGLED_ON ",e.TOGGLED_OFF="TOGGLED_OFF",e.TOGGLED_IMG_2_IMG_ON="TOGGLED_IMG_2_IMG_ON",e.TOGGLED_IMG_PROMPT_ON="TOGGLED_IMG_PROMPT_ON",e.TOGGLED_FOREGROUND_ONLY_ON="TOGGLED_FOREGROUND_ONLY_ON",e.TOGGLED_TRANSPARENCY_OFF="TOGGLED_TRANSPARENCY_OFF",e}(I||{});class S{transform(e){let t={...e,toggleStatusImageToImage:this.getImageToImageStatus({mode:g.IMAGE_TO_IMAGE,...e}),toggleStatusPromptMagic:this.getToggleStatus({mode:g.LEONARDO_MAGIC,...e}),toggleStatusPhotoReal:this.getToggleStatus({mode:g.PHOTO_REAL,...e}),toggleStatusAlchemy:this.getToggleStatus({mode:g.ALCHEMY,...e}),toggleStatusSvd:this.getToggleStatus({mode:g.SVD,...e}),toggleStatusTransparency:this.getTransparencyStatus({mode:g.TRANSPARENCY,...e})};return(this.prospectiveSettings={...e.currentSettings,...(0,c.g3)(e.nextSettings),...this.maximalDimensionTransform(t)},this.wasAlchemyToggledOn="TOGGLED_ON "===t.toggleStatusAlchemy,this.wasAlchemyToggledOff="TOGGLED_OFF"===t.toggleStatusAlchemy,this.wasPhotoRealToggledOn="TOGGLED_ON "===t.toggleStatusPhotoReal,this.wasPhotoRealToggledOff="TOGGLED_OFF"===t.toggleStatusPhotoReal,this.wasPromptMagicToggledOn="TOGGLED_ON "===t.toggleStatusPromptMagic,this.wasPromptMagicToggledOff="TOGGLED_OFF"===t.toggleStatusPromptMagic,this.wasImagePromptToggledOn="TOGGLED_IMG_PROMPT_ON"===t.toggleStatusImageToImage,this.wasSvdToggledOn="TOGGLED_ON "===t.toggleStatusSvd,this.wasSvdToggledOff="TOGGLED_OFF"===t.toggleStatusSvd,this.wasTransparencyForegroundToggledOn="TOGGLED_FOREGROUND_ONLY_ON"===t.toggleStatusTransparency,this.wasTransparencyToggledOff="TOGGLED_TRANSPARENCY_OFF"===t.toggleStatusTransparency,this.setPreconditionForIllegalValues(t),this.setPreconditionForImagePrompt(t),this.setPreconditionForSdxl(e),this.setEnsuredConditionForControlNet(),this.wasPhotoRealToggledOn)?this.normalizeForPhotoRealToggledOn(e,t):this.wasAlchemyToggledOff?this.normalizeForAlchemyToggledOff(e):this.wasPhotoRealToggledOff?this.normalizeForPhotoRealToggledOff():this.wasAlchemyToggledOn?this.normalizeForAlchemyToggledOn(t):this.wasPromptMagicToggledOn?this.normalizeForPromptMagicToggledOn(e):this.wasPromptMagicToggledOff?this.normalizeForPromptMagicToggledOff():this.wasImagePromptToggledOn?this.normalizeForImagePromptToggledOn():this.wasSvdToggledOn?this.normalizeForSvdToggledOn():this.wasSvdToggledOff?this.normalizeForSvdToggledOff():this.wasTransparencyForegroundToggledOn?this.normalizeForTransparencyToggledOn(e):this.wasTransparencyToggledOff?this.normalizeForTransparencyToggledOff():(this.normalizeGuidanceScale(),this.prospectiveSettings)}setPreconditionForIllegalValues(e){let{nextSettings:t,currentSettings:i}=e;i.promptMagicStrength||t.promptMagicStrength||(this.prospectiveSettings.promptMagicStrength=u.TG.promptMagicStrength);let a=[m.We.Low,m.We.Medium,m.We.High].includes(this.prospectiveSettings.photoRealStrength);i.photoRealVersion!==n.PhotoRealVersion.V2||t.photoRealVersion!==n.PhotoRealVersion.V1||m.Gi.includes(i.style)||(this.prospectiveSettings.style=m.r8),t.modelId===n.MODEL_IDS.PHOTOREAL&&(this.prospectiveSettings.usingPhotoReal=!0,this.prospectiveSettings.photoRealVersion=n.PhotoRealVersion.V1,this.prospectiveSettings.style=m.r8),(!e.nextSettings.motionPrompts||e.nextSettings.motionPrompts.length)&&e.currentSettings.motionPrompts.length||(this.prospectiveSettings.motionPrompts=u.TG.motionPrompts),a||(this.prospectiveSettings.photoRealStrength=u.TG.photoRealStrength),Object.keys(m.tv).includes(this.prospectiveSettings.modelId)&&!this.prospectiveSettings.usingAlchemy&&(this.prospectiveSettings.style=m.tv[this.prospectiveSettings.modelId].style);let s=this.getImageStrength();this.getImg2Img()&&null==s&&this.setImageStrength(u.TG.imageStrength),this.prospectiveSettings.stepCount||(this.prospectiveSettings.stepCount=this.prospectiveSettings.scheduler===o.sd_generation_schedulers.LEONARDO?m.gF:m.bK)}handleSdxlOff(e){var t,i;let n=null===(t=this.modelInfoMap)||void 0===t?void 0:t[e.currentSettings.modelId],a=e.nextSettings.modelId&&(null===(i=this.modelInfoMap)||void 0===i?void 0:i[e.nextSettings.modelId]),s=a&&(0,h.kt)(a.sdVersion),r=n&&(0,h.kt)(n.sdVersion);!s&&r&&e.currentSettings.usingAlchemy&&(this.log("".concat(this.setPreconditionForSdxl.name,": Re-enabled PMv3")),this.prospectiveSettings.leonardoMagicVersion=o.PROMPT_MAGIC_VERSIONS.v3,this.prospectiveSettings.usingLeonardoMagic=!0,this.prospectiveSettings.usingTransparency=d.P2Y.Disabled)}handleSdxlOn(e){var t;let i=e.nextSettings.modelId&&(null===(t=this.modelInfoMap)||void 0===t?void 0:t[e.nextSettings.modelId]);i&&(0,h.kt)(i.sdVersion)&&(this.log("".concat(this.setPreconditionForSdxl.name,": Set SDXL values for Alchemy (and disabled PM)")),this.prospectiveSettings.usingLeonardoMagic&&(this.prospectiveSettings.usingTransparency=d.P2Y.Disabled,this.prospectiveSettings.usingAlchemy&&(this.prospectiveSettings.usingLeonardoMagic=!1),this.prospectiveSettings.leonardoMagicVersion=o.PROMPT_MAGIC_VERSIONS.v2))}setPreconditionForSdxl(e){e.nextSettings.modelId&&(this.handleSdxlOff(e),this.handleSdxlOn(e))}setPreconditionForImagePrompt(e){var t;let i=this.prospectiveSettings.imageToImageStrategy,n=this.prospectiveSettings;if("TOGGLED_OFF"===e.toggleStatusPromptMagic){this.prospectiveSettings.imageToImageStrategy=u.rh.IMG_2_IMG;return}let a=(null===(t=this.getImagePrompts())||void 0===t?void 0:t.length)&&i===u.rh.IMG_PROMPT,s=this.getImg2Img()&&i===u.rh.IMG_2_IMG;if(a&&!this.prospectiveSettings.usingLeonardoMagic&&("TOGGLED_OFF"===e.toggleStatusAlchemy?(this.log("".concat(this.setPreconditionForImagePrompt.name,": Reverted to IMG_2_IMG strategy")),this.prospectiveSettings.imageToImageStrategy=u.rh.IMG_2_IMG):(this.log("".concat(this.setPreconditionForImagePrompt.name,": Set to PMV3 and enabled Prompt Magic")),this.prospectiveSettings.leonardoMagicVersion=o.PROMPT_MAGIC_VERSIONS.v3,this.prospectiveSettings.usingLeonardoMagic=!0)),e.nextSettings.usingLeonardoMagic&&e.nextSettings.leonardoMagicVersion===o.PROMPT_MAGIC_VERSIONS.v2){this.prospectiveSettings.imageToImageStrategy=u.rh.IMG_PROMPT;return}if(e.currentSettings.imageToImageStrategy===u.rh.IMG_PROMPT&&e.nextSettings.leonardoMagicVersion===o.PROMPT_MAGIC_VERSIONS.v3){this.prospectiveSettings.imageToImageStrategy=u.rh.IMG_2_IMG;return}s&&n.usingLeonardoMagic&&n.usingAlchemy&&(this.prospectiveSettings.leonardoMagicVersion=o.PROMPT_MAGIC_VERSIONS.v3)}setEnsuredConditionForControlNet(){this.modelInfoMap&&((0,l.Ke)({modelInfo:this.getSelectedModelInfoFromGenerationSettings(this.modelInfoMap,this.prospectiveSettings),initImage:this.isCanvas||!!this.getImg2Img(),usingLeonardoMagic:this.prospectiveSettings.usingLeonardoMagic,usingAlchemy:this.prospectiveSettings.usingAlchemy})||(this.log("".concat(this.setEnsuredConditionForControlNet.name,": Disabled Pose-to-Image")),this.prospectiveSettings.usingPoseToImage=!1))}getImagePrompts(){var e;return null===(e=this.prospectiveSettings.imageInputs)||void 0===e?void 0:e.filter(e=>e.type===p.w.ImagePrompt)}getImg2Img(){var e;return null===(e=this.prospectiveSettings.imageInputs)||void 0===e?void 0:e.find(e=>e.type===p.w.Img2Img)}getImageStrength(){var e;return null===(e=this.getImg2Img())||void 0===e?void 0:e.weighting}setImageStrength(e){let t=this.getImg2Img();t&&(t.weighting=e)}normalizeForAlchemyToggledOn(e){var t;this.log("".concat(this.normalizeForAlchemyToggledOn.name,": Called"));let i={...this.prospectiveSettings},n=null!==(t=e.currentSettings.modelId)&&void 0!==t?t:u.TG.modelId,a=(0,h.p4)(n);return this.log("".concat(this.normalizeForAlchemyToggledOn.name,": Ensured PMV3")),i.usingLeonardoMagic=!0,i.usingTransparency=d.P2Y.Disabled,i.usingPoseToImage=!1,i.style=m.oV,i.usingExpandedDomain=!0,i.promptMagicStrength=m.Ye,i.leonardoMagicVersion=o.PROMPT_MAGIC_VERSIONS.v3,this.log("".concat(this.normalizeForAlchemyToggledOn.name,": Switch to Image to Image")),i.imageToImageStrategy=u.rh.IMG_2_IMG,a&&(this.log("".concat(this.normalizeForAlchemyToggledOn.name,": Ensured prompt magic is turned off for SDXL model")),i.usingLeonardoMagic=!1,i.usingTransparency=e.currentSettings.usingTransparency),i}normalizeForAlchemyToggledOff(e){this.log("".concat(this.normalizeForAlchemyToggledOff.name,": Called"));let t=r()(this.prospectiveSettings);return e.currentSettings.usingPhotoReal&&(t=this.normalizeForPhotoRealToggledOff()),{...t,imageToImageStrategy:u.rh.IMG_2_IMG,promptMagicStrength:m.WY,leonardoMagicVersion:o.PROMPT_MAGIC_VERSIONS.v2,usingPhotoReal:!1,usingLeonardoMagic:!1,style:(0,h.Co)(this.prospectiveSettings.modelId)}}normalizeForPhotoRealToggledOn(e,t){this.log("".concat(this.normalizeForPhotoRealToggledOn.name,": Called"));let i=r()(this.prospectiveSettings);e.currentSettings.usingAlchemy||(i=this.normalizeForAlchemyToggledOn(t));let o=e.nextSettings.modelId&&(0,h.$V)(e.nextSettings.modelId)?e.nextSettings.modelId:n.PhotoRealV2Models.KINO_XL.id;return{...i,modelId:i.photoRealVersion===n.PhotoRealVersion.V2?o:n.MODEL_IDS.PHOTOREAL,imageToImageStrategy:u.rh.IMG_2_IMG,photoRealStrength:m.j,style:m.r8,usingNegativePrompt:!1,usingLeonardoMagic:!1,usingAlchemy:!0,usingSvd:!1}}normalizeForPhotoRealToggledOff(){return this.log("".concat(this.normalizeForPhotoRealToggledOff.name,": Called")),{...this.prospectiveSettings,style:m.oV,modelId:u.TG.modelId}}normalizeForSvdToggledOn(){return this.log("".concat(this.normalizeForSvdToggledOn.name,": Called")),{...this.prospectiveSettings,usingNegativePrompt:!1,usingLeonardoMagic:!1,usingPoseToImage:!1,usingPhotoReal:!1,usingAlchemy:!1,usingSvd:!0,numberOfImages:n.MOTION_MAX_OUTPUTS_PER_GENERATION}}normalizeForSvdToggledOff(){return this.log("".concat(this.normalizeForSvdToggledOff.name,": Called")),{...this.prospectiveSettings,usingSvd:!1}}normalizeForTransparencyToggledOn(e){this.log("".concat(this.normalizeForTransparencyToggledOn.name,": Called"));let t=r()(this.prospectiveSettings);return(0,h.ZJ)(e.currentSettings.modelId)&&(t.modelId=n.MODEL_IDS.DIFFUSION_XL),{...t,promptMagicStrength:m.WY,usingLeonardoMagic:!1,usingTransparency:d.P2Y.ForegroundOnly}}normalizeForTransparencyToggledOff(){return this.log("".concat(this.normalizeForTransparencyToggledOff.name,": Called")),{...this.prospectiveSettings,usingTransparency:d.P2Y.Disabled}}normalizeForPromptMagicToggledOn(e){this.log("".concat(this.normalizeForPromptMagicToggledOn.name,": Called"));let t={...this.prospectiveSettings};return this.prospectiveSettings.usingAlchemy&&(t.usingPhotoReal=!1),this.prospectiveSettings.leonardoMagicVersion===o.PROMPT_MAGIC_VERSIONS.v3&&(t.usingAlchemy=!0),(e.currentSettings.usingPhotoReal||(0,h.bZ)(e.currentSettings.modelId))&&(t.modelId=u.TG.modelId),t.leonardoMagicVersion===o.PROMPT_MAGIC_VERSIONS.v2?t.imageToImageStrategy=u.rh.IMG_PROMPT:t.leonardoMagicVersion===o.PROMPT_MAGIC_VERSIONS.v3&&(t.imageToImageStrategy=u.rh.IMG_2_IMG),t.usingTransparency=d.P2Y.Disabled,t}normalizeForPromptMagicToggledOff(){this.log("".concat(this.normalizeForPromptMagicToggledOff.name,": Called"));let e={...this.prospectiveSettings};return e.imageToImageStrategy=u.rh.IMG_2_IMG,e}normalizeForImagePromptToggledOn(){this.log("".concat(this.normalizeForImagePromptToggledOn.name,": Called")),this.log("".concat(this.normalizeForImagePromptToggledOn.name,": Ensured PMv2"));let e={...this.prospectiveSettings};return e.usingLeonardoMagic=!0,e.leonardoMagicVersion=o.PROMPT_MAGIC_VERSIONS.v2,e}maximalDimensionTransform(e){var t,i,n,o;let a={width:null!==(t=e.nextSettings.width)&&void 0!==t?t:e.currentSettings.width,height:null!==(i=e.nextSettings.height)&&void 0!==i?i:e.currentSettings.height,highResolution:null!==(n=e.nextSettings.highResolution)&&void 0!==n?n:e.currentSettings.highResolution};a.width*a.height<=1048576||(this.log("".concat(this.maximalDimensionTransform.name,": Disabled high resolution")),a.highResolution=!1);let s=null!==(o=e.nextSettings.usingRecommendedDimensions)&&void 0!==o?o:e.currentSettings.usingRecommendedDimensions;return s&&"TOGGLED_ON "===e.toggleStatusAlchemy&&(a.height=m.XM,a.width=m.sf),s&&"TOGGLED_ON "===e.toggleStatusPhotoReal&&(a.height=m.GV,a.width=m.hd),a.width=Math.min(a.width,m.ss),a.height=Math.min(a.height,m.ss),a}normalizeGuidanceScale(){let{guidanceScale:e}=this.prospectiveSettings;null==e&&(this.prospectiveSettings.guidanceScale=u.TG.guidanceScale)}getSelectedModelInfoFromGenerationSettings(e,t,i){let n=t.modelId;return i||(i=n),e[i]||e[u.TG.modelId]||{}}getImageToImageStatus(e){let{mode:t,currentSettings:i,nextSettings:n}=e;return i[t]===u.rh.IMG_2_IMG&&n[t]===u.rh.IMG_PROMPT?"TOGGLED_IMG_PROMPT_ON":i[t]===u.rh.IMG_PROMPT&&n[t]===u.rh.IMG_2_IMG?"TOGGLED_IMG_2_IMG_ON":null}getTransparencyStatus(e){let{mode:t,currentSettings:i,nextSettings:n}=e;return i[t]===d.P2Y.Disabled&&n[t]===d.P2Y.ForegroundOnly?"TOGGLED_FOREGROUND_ONLY_ON":i[t]===d.P2Y.ForegroundOnly&&n[t]===d.P2Y.Disabled?"TOGGLED_TRANSPARENCY_OFF":null}getToggleStatus(e){let{mode:t,currentSettings:i,nextSettings:n}=e;return!1===i[t]&&!0===n[t]?"TOGGLED_ON ":!0===i[t]&&!1===n[t]?"TOGGLED_OFF":null}log(e){let t="".concat(S.name," ➡️");a.Z({type:"state",category:"SettingsNormalizer",message:e,level:"debug"}),this.verbose&&console.log("".concat(t," ").concat(e))}constructor(e){var t;this.verbose=!!Number(_.env.NEXT_PUBLIC_SETTINGS_NORMALIZER_VERBOSITY),this.modelInfoMap=null!==(t=null==e?void 0:e.modelInfoMap)&&void 0!==t?t:null,this.isCanvas=!!(null==e?void 0:e.isCanvas),this.prospectiveSettings=u.TG}}let T=S},68153:(e,t,i)=>{i.d(t,{Vq:()=>W,_b:()=>j,Ay:()=>J,dZ:()=>B,IJ:()=>k,k6:()=>X,lM:()=>Z,Tx:()=>x,VS:()=>U,Z2:()=>z,HL:()=>H});var n={};i.r(n),i.d(n,{addImagePrompt:()=>E,addLoadingVariation:()=>L,decrementUploadCount:()=>A,deleteLoadingVariation:()=>b,forgetModelId:()=>P,incrementUploadCount:()=>f,removeImageInputsUsingUploadId:()=>N,removeImagePrompt:()=>w,resetSettings:()=>R,setImageGuidanceSidebarRedirectAsViewed:()=>G,setLastModelId:()=>O,setModelId:()=>v,showAdvancedGenerationSettings:()=>y});var o=i(6328),a=i(88520),s=i(18091),r=i(66861),g=i(60519),l=i(12142),d=i(6963);let m={showAdvancedSettings:!1,lastModelIds:[],settings:(0,l.Az)(),isGenerating:!1,modelInfo:{modelInfoMap:{},leoModelInfoMap:{},customModelInfoMap:{},isLoading:!1,firstLoadComplete:!1},loadingVariations:{},imagesUploadingCount:0,recentImages:[],hasClosedImageGuidanceSidebarRedirect:!1};var c=i(30284),u=i(958),p=i(85756),h=i(66415),_=i(35936),I=i(78192),S=i(75264),T=i(53270),M=i(31698);let v=(e,t)=>{e.lastModelIds=(0,d.FP)(t.payload,e.lastModelIds);let i=new r.A().transform({currentSettings:e.settings,nextSettings:{...e.settings,modelId:t.payload}});Object.assign(e.settings,i)},O=(e,t)=>{(0,_.Bw)(t.payload)||(e.lastModelIds=(0,d.FP)(t.payload,e.lastModelIds))},P=(e,t)=>{e.lastModelIds=(0,h.E6)(e.lastModelIds,t.payload)},y=(e,t)=>{e.showAdvancedSettings=t.payload},R=(e,t)=>{let i=t.payload,n={...m.settings,...i&&l.r0,public:e.settings.public};(0,T.wb)(e.settings,n)},f=e=>{e.imagesUploadingCount=e.imagesUploadingCount+1},G=e=>{e.hasClosedImageGuidanceSidebarRedirect=!0},A=e=>{e.imagesUploadingCount>0&&(e.imagesUploadingCount=e.imagesUploadingCount-1)},E=(e,t)=>{if(t.payload.useMultipleControlNetLogic){let i=e.settings.imageInputs.filter(e=>e.initImageId!==t.payload.image.id);if(!t.payload.image.id)throw Error("No initImageId passed to addImagePrompt reducer?");e.settings.imageInputs=(0,h.jr)(i,{type:M.w.ImagePrompt,initImageId:t.payload.image.id,initImageType:{[I.Ab.Upload]:u.AbP.Uploaded,[I.Ab.Generated]:u.AbP.Generated}[t.payload.image.type],isEnabled:!0,weighting:(0,c.WO)({imageInputType:M.w.ImagePrompt}).default,dimensions:t.payload.dimensions},p.pz)}else{let i=e.settings.imagePrompts.filter(e=>e.url!==t.payload.image.url);e.settings.imagePrompts=(0,h.jr)(i,t.payload.image,p.pz).sort(d.B6)}},w=(e,t)=>{if(t.payload.useMultipleControlNetLogic){let i=e.settings.imageInputs.filter(e=>e.initImageId!==t.payload.image.id);e.settings.imageInputs=i}else{let i=e.settings.imagePrompts.filter(e=>e.url!==t.payload.image.url);e.settings.imagePrompts=i.sort(d.B6)}},L=(e,t)=>{let{imageId:i,imageVariationType:n}=t.payload;return{...e,loadingVariations:{...e.loadingVariations,[i]:[...e.loadingVariations[i]||[],n]}}},b=(e,t)=>{let i=(0,S.td)(e.loadingVariations,t.payload);return{...e,loadingVariations:i}},N=(e,t)=>{e.settings.imageInputs=e.settings.imageInputs.filter(e=>e.initImageType!==u.AbP.Uploaded||e.initImageId!==t.payload)},V=e=>e?Array.isArray(e)?e:[e]:[],C=(0,a.l1)(e=>({...e,imageInputs:(e.imageInputs||[]).map(e=>{let t={...e};return delete t.base64ImageUri,delete t.isUploading,t}),scheduler:m.settings.scheduler,seed:m.settings.seed,imageStrength:m.settings.imageStrength,stepCount:m.settings.stepCount,guidanceScale:m.settings.guidanceScale,usingFixedSeed:m.settings.usingFixedSeed,initImage:m.settings.initImage,imagePrompts:m.settings.imagePrompts,usingNegativePrompt:m.settings.usingNegativePrompt,photoRealStrength:m.settings.photoRealStrength,promptMagicStrength:m.settings.promptMagicStrength,usingHighContrast:m.settings.usingHighContrast,usingPoseToImage:m.settings.usingPoseToImage,poseToImageWeight:m.settings.poseToImageWeight,poseToImageType:m.settings.poseToImageType,highResolution:m.settings.highResolution,contrastBoost:m.settings.contrastBoost,resonance:m.settings.resonance,usingExpandedDomain:m.settings.usingExpandedDomain,tiling:m.settings.tiling}),e=>{let t=new r.A;return e.imagePrompts=V(e.imagePrompts),e.imageInputs=V(e.imageInputs),e.imageInputs.forEach(e=>{e.isEnabled=!1}),e.motionPrompts&&e.motionPrompts.length||(e.motionPrompts=l.TG.motionPrompts),"boolean"==typeof e.usingTransparency&&(e.usingTransparency?e.usingTransparency=u.P2Y.ForegroundOnly:e.usingTransparency=u.P2Y.Disabled),t.transform({currentSettings:(0,l.Az)(),nextSettings:e})},{whitelist:["settings"]}),D=(0,a.l1)(e=>(e||[]).map(e=>{let t={...e};return delete t.base64ImageUri,delete t.isUploading,t}),e=>e,{whitelist:["recentImages"]}),F=(0,o.Z0)({name:"generation",initialState:m,reducers:n,extraReducers:e=>{e.addCase(g.Kt.pending,e=>({...e,modelInfo:{...e.modelInfo,isLoading:!0}})),e.addCase(g.Kt.fulfilled,(e,t)=>({...e,modelInfo:{...t.payload,isLoading:!1,firstLoadComplete:!0}})),e.addCase(g.Kt.rejected,e=>({...e,modelInfo:{...e.modelInfo,isLoading:!1}})),e.addCase(g.ac.pending,e=>({...e,isGenerating:!0})),e.addCase(g.ac.fulfilled,e=>({...e,isGenerating:!1})),e.addCase(g.ac.rejected,e=>({...e,isGenerating:!1})),e.addCase(g.oc.fulfilled,(e,t)=>{let i=new r.A({modelInfoMap:e.modelInfo.modelInfoMap}).transform({currentSettings:e.settings,nextSettings:t.payload});return{...e,settings:{...e.settings,...i}}}),e.addCase(g.xl.fulfilled,(e,t)=>({...e,settings:{...e.settings,...t.payload}}))}}),{setModelId:z,setLastModelId:U,resetSettings:x,forgetModelId:k,addImagePrompt:Y,removeImagePrompt:q,showAdvancedGenerationSettings:H,addLoadingVariation:W,deleteLoadingVariation:B,incrementUploadCount:X,decrementUploadCount:j,setImageGuidanceSidebarRedirectAsViewed:K,removeImageInputsUsingUploadId:Z}=F.actions;F.reducer;let J=(0,a.rL)({key:"generation",transforms:[C,D],storage:s.A,whitelist:["settings","hasClosedImageGuidanceSidebarRedirect","recentImages"]},F.reducer)},69756:(e,t,i)=>{i.d(t,{$:()=>D,BI:()=>T,CS:()=>r,Ce:()=>o,Ck:()=>z,Dh:()=>q,Dj:()=>ed,Eo:()=>b,F2:()=>Q,FC:()=>W,FH:()=>es,Fh:()=>x,G4:()=>eg,GP:()=>X,Gq:()=>Y,H6:()=>V,Hk:()=>R,JP:()=>ea,Jo:()=>h,LW:()=>E,MG:()=>S,NI:()=>er,Od:()=>ee,Oe:()=>g,P4:()=>y,PT:()=>B,SX:()=>_,SZ:()=>K,Sv:()=>ec,TP:()=>d,V$:()=>em,VK:()=>F,XO:()=>G,XX:()=>eu,Xl:()=>l,_0:()=>j,_G:()=>a,_H:()=>O,_i:()=>U,ct:()=>N,dK:()=>et,eX:()=>p,ee:()=>ei,eu:()=>P,fl:()=>m,fq:()=>en,gv:()=>A,hW:()=>eo,ie:()=>f,kW:()=>C,kn:()=>eh,kx:()=>u,l3:()=>L,lA:()=>Z,m_:()=>ep,me:()=>s,mz:()=>v,nK:()=>M,ol:()=>H,pE:()=>eI,pW:()=>e_,q5:()=>I,qv:()=>w,rR:()=>n,ud:()=>k,wt:()=>$,y3:()=>J,yM:()=>el,zR:()=>c});let n="categories_filter",o="community_feed_load",a="bulk_download_request",s="datasets_create_element_button",r="datasets_create_element_button_empty_state",g="default_preset",l="image_remix",d="generate_images",m="is_hide_username_field_on_signup_experiment",c="web_client_is_streamlined_cancellation_flow_enabled",u="web_client_successful_image_generation",p="image_generation_resolution_toggle_button",h="image_guidance_image_upload",_="image_guidance_drag_drop_end",I="image_guidance_add_elements_options",S="web_client_intent_to_pay_consumer_and_teams",T="generate_ldi",M="lightning_stream_generate",v="lightning_stream_generate_more",O="lightning_stream_upscale_button",P="lightning_stream_save_button",y="lightning_stream_download_button",R="lightning_stream_image_generation_complete",f="login_sign_up_alternative_sso",G="login_sign_up_email_continue",A="login_sign_up_sso",E="sign_up_simple_onboarding_complete",w="upgrade_modal_plan_toggle",L="upgrade_modal_duration_toggle",b="retention_offer_show",N="generate_motion",V="api_plans_checkout_initiated",C="subscription_discount_offer_accepted",D="view_item_list",F="purchase",z="begin_checkout",U="premiumplans_checkout_initiated",x="initiate_teams_checkout",k="prompt_enhance_describe_image",Y="quick_actions_upscale_button",q="quick_actions_generate_motion_button",H="quick_actions_edit_in_canvas_button",W="quick_actions_more_options_button",B="quick_actions_use_as_image_guidance_button",X="quick_actions_describe_with_ai_button",j="quick_actions_remove_backgrounds_button",K="quick_actions_view_removed_backgrounds_button",Z="quick_actions_edit_character_pose_button",J="quick_actions_organize_button",$="quick_actions_delete_image_button",Q="quick_actions_download_button",ee="signup",et="storyboard_generation_request",ei="storyboard_style_selected",en="generate_svd",eo="web_client_subscription_success_redirect",ea="tokens_depleted",es="training_model_category_step_completed",er="training_model_create_or_edit_dataset_step_completed",eg="training_model_dataset_selection_step_completed",el="training_model_open_modal",ed="train_model_request",em="delete_account_confirmation",ec="submit_user_feedback_survey_data",eu="collections_popover_open",ep="collections_move_button_click",eh="collections_selection_change",e_="collections_modal_open",eI="collections_create_new_click"},78163:(e,t,i)=>{i.d(t,{U:()=>r});var n=i(6328),o=i(39264),a=i(958),s=i(25634);let r=(0,n.zD)("trials/updateAlchemyTrialState",async(e,t)=>{let{getState:i}=t,{user:n}=i();return"FREE"!==n.plan&&(0,o.gL)()?null:(await s.Ay.query({query:a.I1u,fetchPolicy:"network-only"})).data.queryUserAlchemyTrial})},86182:(e,t,i)=>{i.d(t,{Ke:()=>o,O4:()=>a,tz:()=>s});var n=i(46671);let o=e=>{let{modelInfo:t,initImage:i,usingAlchemy:n,isCanvas:o=!1,usingLeonardoMagic:s}=e;if(n||s)return!1;let r=a(t,o),g=o||!!i;return r&&g},a=(e,t)=>!t||e.sdVersion===n.sd_versions.v1_5,s=e=>{let{usingAlchemy:t,usingPhotoReal:i,leonardoMagicVersion:o}=e;return t||i||o===n.PROMPT_MAGIC_VERSIONS.v3}}}]);